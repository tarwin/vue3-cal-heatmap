(function(_,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("tippy.js")):typeof define=="function"&&define.amd?define(["exports","vue","tippy.js"],e):(_=typeof globalThis<"u"?globalThis:_||self,e(_.CalendarHeatmap={},_.Vue,_.tippy))})(this,function(_,e,u){"use strict";var Ee=Object.defineProperty;var fe=(_,e,u)=>e in _?Ee(_,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[e]=u;var d=(_,e,u)=>fe(_,typeof e!="symbol"?e+"":e,u);const c=class c{constructor(a,n,o,s=c.DEFAULT_RANGE_COLOR_LIGHT,h=0,i="linear"){d(this,"startDate");d(this,"endDate");d(this,"startWeekday");d(this,"max");d(this,"colorRange");d(this,"_values");d(this,"_firstFullWeekOfMonths");d(this,"_activities");d(this,"_calendar");d(this,"colorScale");d(this,"_percentileThresholds");this.endDate=this.parseDate(a),this.max=o||Math.ceil(Math.max(...n.map(g=>g.count))/5*4),this.startWeekday=h,this.colorRange=s,this.colorScale=i,this.startDate=this.shiftDate(a,-c.DAYS_IN_ONE_YEAR),this._values=n}set values(a){this.max=Math.ceil(Math.max(...a.map(n=>n.count))/5*4),this._values=a,this._firstFullWeekOfMonths=void 0,this._calendar=void 0,this._activities=void 0,this._percentileThresholds=void 0}get values(){return this._values}get activities(){if(!this._activities){this._activities=new Map;for(let a=0,n=this.values.length;a<n;a++)this._activities.set(this.keyDayParser(this.values[a].date),{count:this.values[a].count,colorIndex:this.getColorIndex(this.values[a].count)})}return this._activities}get weekCount(){return this.getDaysCount()/c.DAYS_IN_WEEK}get calendar(){if(!this._calendar){let a=this.shiftDate(this.startDate,-this.getCountEmptyDaysAtStart());a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),this._calendar=new Array(this.weekCount);for(let n=0,o=this._calendar.length;n<o;n++){this._calendar[n]=new Array(c.DAYS_IN_WEEK);for(let s=0;s<c.DAYS_IN_WEEK;s++){const h=this.activities.get(this.keyDayParser(a));this._calendar[n][s]={date:new Date(a.valueOf()),count:h?h.count:void 0,colorIndex:h?h.colorIndex:0},a.setDate(a.getDate()+1)}}}return this._calendar}get firstFullWeekOfMonths(){if(!this._firstFullWeekOfMonths){const a=this.calendar;this._firstFullWeekOfMonths=[];for(let n=1,o=a.length;n<o;n++){const s=a[n-1][0].date,h=a[n][0].date;(s.getFullYear()<h.getFullYear()||s.getMonth()<h.getMonth())&&this._firstFullWeekOfMonths.push({value:h.getMonth(),index:n})}}return this._firstFullWeekOfMonths}getCountEmptyDaysAtStart(){return this.startDate.getDay()}getDayOfWeek(a){return(a.getDay()-this.startWeekday+c.DAYS_IN_WEEK)%c.DAYS_IN_WEEK}getCountEmptyDaysAtEnd(){return c.DAYS_IN_WEEK-1-this.endDate.getDay()}getDaysCount(){return c.DAYS_IN_ONE_YEAR+1+this.getCountEmptyDaysAtStart()+this.getCountEmptyDaysAtEnd()}shiftDate(a,n){const o=new Date(a);return o.setDate(o.getDate()+n),o}parseDate(a){return a instanceof Date?a:new Date(a)}keyDayParser(a){const n=this.parseDate(a);return String(n.getFullYear())+String(n.getMonth()).padStart(2,"0")+String(n.getDate()).padStart(2,"0")}get percentileThresholds(){if(!this._percentileThresholds){const a=this._values.map(o=>o.count).filter(o=>o>0).sort((o,s)=>o-s);if(a.length===0)return this._percentileThresholds=[],this._percentileThresholds;const n=this.colorRange.length-1;this._percentileThresholds=[];for(let o=1;o<n;o++){const s=o/n,h=Math.floor(s*a.length);this._percentileThresholds.push(a[Math.min(h,a.length-1)])}}return this._percentileThresholds}getColorIndex(a){if(a==null)return 0;if(a<=0)return 1;if(a>=this.max)return this.colorRange.length-1;switch(this.colorScale){case"percentile":return this.getPercentileColorIndex(a);case"logarithmic":return this.getLogarithmicColorIndex(a);default:return this.getLinearColorIndex(a)}}getLinearColorIndex(a){const n=a/this.max;return Math.floor(n*(this.colorRange.length-2))+1}getPercentileColorIndex(a){const n=this.percentileThresholds;if(n.length===0)return 1;for(let o=0;o<n.length;o++)if(a<=n[o])return o+1;return this.colorRange.length-1}getLogarithmicColorIndex(a){const n=Math.log(a+1),o=Math.log(this.max+1),s=n/o;return Math.floor(s*(this.colorRange.length-2))+1}};d(c,"DEFAULT_RANGE_COLOR_LIGHT",["#ebedf0","#dae2ef","#c0ddf9","#73b3f3","#3886e1","#17459e"]),d(c,"DEFAULT_RANGE_COLOR_DARK",["#1f1f22","#1e334a","#1d466c","#1d5689","#1d69ac","#1B95D1"]),d(c,"DEFAULT_LOCALE",{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],on:"on",less:"Less",more:"More"}),d(c,"DEFAULT_TOOLTIP_UNIT","contributions"),d(c,"DAYS_IN_ONE_YEAR",365),d(c,"DAYS_IN_WEEK",7),d(c,"SQUARE_SIZE",10);let l=c;const F=e.defineComponent({name:"CalendarHeatmap",props:{endDate:{required:!0},startWeekday:{type:Number,default:0},max:{type:Number},rangeColor:{type:Array},values:{type:Array,required:!0},locale:{type:Object},tooltip:{type:Boolean,default:!0},tooltipUnit:{type:String,default:l.DEFAULT_TOOLTIP_UNIT},tooltipFormatter:{type:Function},noDataText:{type:[Boolean,String],default:null},round:{type:Number,default:0},darkMode:Boolean,showLegend:{type:Boolean,default:!0},showWeekdays:{type:Boolean,default:!0},asDots:{type:Boolean,default:!1},dayClasses:{type:[String,Array],default:""},colorScale:{type:String,default:"linear"}},emits:["dayClick"],setup(t){const a=l.SQUARE_SIZE/5,n=l.SQUARE_SIZE+a,o=t.showWeekdays?Math.ceil(l.SQUARE_SIZE*2.5):0,s=n*3,h=l.SQUARE_SIZE+l.SQUARE_SIZE/2,i=l.SQUARE_SIZE+l.SQUARE_SIZE/2,g=`translate(${o}, ${h})`,D=e.ref(null),p=e.ref(new Date),y=e.ref(new l(t.endDate,t.values,t.max,t.rangeColor,t.startWeekday,t.colorScale)),I=e.ref(0),R=e.ref(0),B=e.ref("0 0 0 0"),w=e.ref("0 0 0 0"),N=e.ref(""),O=e.ref(""),M=e.ref(""),S=e.ref({}),k=e.ref(t.rangeColor||(t.darkMode?l.DEFAULT_RANGE_COLOR_DARK:l.DEFAULT_RANGE_COLOR_LIGHT)),ae=l.DAYS_IN_WEEK,U=e.ref(t.round);t.asDots&&(U.value=20);const{values:ne,tooltipUnit:re,tooltipFormatter:oe,noDataText:le,max:se,locale:ie}=e.toRefs(t),f=new Map;let m;function W(){f.clear(),m?m.setInstances(Array.from(f.values())):m=u.createSingleton(Array.from(f.values()),{overrides:[],moveTransition:"transform 0.1s ease-out",allowHTML:!0})}function de(r){if(t.tooltip){if(r.count!==void 0)return t.tooltipFormatter?t.tooltipFormatter(r,t.tooltipUnit):`<b>${r.count} ${t.tooltipUnit}</b> ${S.value.on} ${S.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`;if(t.noDataText)return`${t.noDataText}`;if(t.noDataText!==!1)return`<b>No ${t.tooltipUnit}</b> ${S.value.on} ${S.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`}}function ce(r){return`translate(${r*n}, 0)`}function he(r){return`translate(0, ${r*n})`}function _e(r){return{x:n*(r.index-1),y:n-a}}e.watch([e.toRef(t,"rangeColor"),e.toRef(t,"darkMode")],([r,E])=>{k.value=r||(E?l.DEFAULT_RANGE_COLOR_DARK:l.DEFAULT_RANGE_COLOR_LIGHT)}),I.value=o+n*y.value.weekCount+a,R.value=h+n*l.DAYS_IN_WEEK,N.value=`translate(0, ${h})`,O.value=`translate(${o}, 0)`,e.watch([I,R],([r,E])=>B.value=` 0 0 ${r} ${E}`,{immediate:!0}),e.watch([I,R,k],([r,E,A])=>{M.value=`translate(${r-n*A.length-30}, ${E-i})`},{immediate:!0}),e.watch(ie,r=>S.value=r?{...l.DEFAULT_LOCALE,...r}:l.DEFAULT_LOCALE,{immediate:!0}),e.watch(k,r=>w.value=`0 0 ${l.SQUARE_SIZE*(r.length+1)} ${l.SQUARE_SIZE}`,{immediate:!0}),e.watch([ne,re,oe,le,se,k],()=>{y.value=new l(t.endDate,t.values,t.max),f.forEach(r=>r.destroy()),e.nextTick(W)}),e.onMounted(W),e.onBeforeUnmount(()=>{m==null||m.destroy(),f.forEach(r=>r.destroy())});function ge(r){if(m&&r.target&&r.target.classList.contains("vch__day__square")&&r.target.dataset.weekIndex!==void 0&&r.target.dataset.dayIndex!==void 0){const E=Number(r.target.dataset.weekIndex),A=Number(r.target.dataset.dayIndex);if(!isNaN(E)&&!isNaN(A)){const C=de(y.value.calendar[E][A]);if(C&&y.value.calendar[E][A].count){const L=f.get(r.target);L?L.setContent(C):L||(f.set(r.target,u(r.target,{content:C})),m.setInstances(Array.from(f.values())))}}}}return{SQUARE_BORDER_SIZE:a,SQUARE_SIZE:n,DAYS_IN_WEEK:ae,LEFT_SECTION_WIDTH:o,RIGHT_SECTION_WIDTH:s,TOP_SECTION_HEIGHT:h,BOTTOM_SECTION_HEIGHT:i,svg:D,heatmap:y,now:p,width:I,height:R,viewbox:B,daysLabelWrapperTransform:N,monthsLabelWrapperTransform:O,yearWrapperTransform:g,legendWrapperTransform:M,lo:S,legendViewbox:w,curRangeColor:k,getWeekPosition:ce,getDayPosition:he,getMonthLabelPosition:_e,initTippyLazy:ge,rounding:U,asDots:t.asDots}}}),$=(t,a)=>{const n=t.__vccOpts||t;for(const[o,s]of a)n[o]=s;return n},b=["viewBox"],Q=["transform"],Z=["x","y"],Y=["transform"],P=["y"],V=["transform"],x=["transform"],G=["rx","ry","transform","width","height","data-week-index","data-day-index","onClick"],K={key:0,class:"vch__legend"},H={class:"vch__legend-left"},z={class:"vch__legend-right"},j={class:"vch__legend"},q=["viewBox","height"],v={class:"vch__legend__wrapper"},J=["rx","ry","width","height","x"];function X(t,a,n,o,s,h){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({vch__container:!0,"dark-mode":t.darkMode})},[(e.openBlock(),e.createElementBlock("svg",{class:"vch__wrapper",ref:"svg",viewBox:t.viewbox},[e.createElementVNode("g",{class:"vch__months__labels__wrapper",transform:t.monthsLabelWrapperTransform},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.firstFullWeekOfMonths,(i,g)=>(e.openBlock(),e.createElementBlock("text",{class:"vch__month__label",key:g,x:t.getMonthLabelPosition(i).x,y:t.getMonthLabelPosition(i).y},e.toDisplayString(t.lo.months[i.value]),9,Z))),128))],8,Q),t.showWeekdays?(e.openBlock(),e.createElementBlock("g",{key:0,class:"vch__days__labels__wrapper",transform:t.daysLabelWrapperTransform},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([0,1,2,3,4,5,6],i=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[(i+t.startWeekday)%2==1?(e.openBlock(),e.createElementBlock("text",{class:"vch__day__label",key:i,x:0,y:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE+t.SQUARE_SIZE*i},e.toDisplayString(t.lo.days[(i+t.startWeekday)%t.DAYS_IN_WEEK]),9,P)):e.createCommentVNode("",!0)],64))),64))],8,Y)):e.createCommentVNode("",!0),e.createElementVNode("g",{class:"vch__year__wrapper",transform:t.yearWrapperTransform,onMouseover:a[0]||(a[0]=(...i)=>t.initTippyLazy&&t.initTippyLazy(...i))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.calendar,(i,g)=>(e.openBlock(),e.createElementBlock("g",{class:"vch__month__wrapper",key:g,transform:t.getWeekPosition(g)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i,(D,p)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:p},[D.date<t.now?(e.openBlock(),e.createElementBlock("rect",{key:0,class:e.normalizeClass(["vch__day__square",t.dayClasses]),rx:t.rounding,ry:t.rounding,transform:t.getDayPosition(p),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,style:e.normalizeStyle({fill:t.curRangeColor[D.colorIndex]}),"data-week-index":g,"data-day-index":p,onClick:y=>t.$emit("dayClick",D)},null,14,G)):e.createCommentVNode("",!0)],64))),128))],8,x))),128))],40,V)],8,b)),t.showLegend?(e.openBlock(),e.createElementBlock("div",K,[e.renderSlot(t.$slots,"legend",{},()=>[e.createElementVNode("div",H,[e.renderSlot(t.$slots,"vch__legend-left")]),e.createElementVNode("div",z,[e.renderSlot(t.$slots,"legend-right",{},()=>[e.createElementVNode("div",j,[e.createElementVNode("div",null,e.toDisplayString(t.lo.less),1),(e.openBlock(),e.createElementBlock("svg",{class:"vch__external-legend-wrapper",viewBox:t.legendViewbox,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE},[e.createElementVNode("g",v,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(i,g)=>(e.openBlock(),e.createElementBlock("rect",{key:g,rx:t.rounding,ry:t.rounding,style:e.normalizeStyle({fill:i}),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,x:t.SQUARE_SIZE*g},null,12,J))),128))])],8,q)),e.createElementVNode("div",null,e.toDisplayString(t.lo.more),1)])])])])])):e.createCommentVNode("",!0)],2)}const T=$(F,[["render",X]]);function ee(t){t.component(T.name,T)}const te={install:ee};_.CalendarHeatmap=T,_.Heatmap=l,_.default=te,Object.defineProperties(_,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue3-cal-heatmap.umd.js.map
